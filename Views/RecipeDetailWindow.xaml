<Window x:Class="CookMaster.Views.RecipeDetailWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="CookMaster - Recipe Details" Height="620" Width="800"
        WindowStartupLocation="CenterOwner"
        Style="{StaticResource {x:Type Window}}">
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="12"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal">
            <Image Source="{StaticResource SteamingPotImage}" HorizontalAlignment="Center"
                   Width="30" Height="30" Stretch="Uniform" Margin="0,0,0,0"/>
            <TextBlock Text="Recipe Details" FontSize="20" FontWeight="Bold" Margin="4" />
        </StackPanel>

        <!-- Right column: buttons -->
        <StackPanel Grid.Row="0" Grid.Column="1" Grid.RowSpan="3" Margin="4,0,0,0">
            <Button Content="{Binding EditButtonText}" Width="160" Height="30" Margin="4"
                    ToolTip="Edit this recipe"
                    Command="{Binding PerformEditCommand}"
                    Visibility="{Binding IsOwnerOrAdmin, Converter={StaticResource BoolToVis}}"
                    Style="{StaticResource ButtonLightGrayStyle}"/>
            <Button Content="Save &amp; Close" Width="160" Height="30" Margin="4" 
                    ToolTip="Save changes and close the window"
                    Command="{Binding PerformSaveCommand}"
                    Visibility="{Binding IsOwnerOrAdmin, Converter={StaticResource BoolToVis}}"
                    Style="{StaticResource ButtonSaveStyle}"/>
            <Button Content="Copy" Margin="4,0,0,0"
                    ToolTip="Create a copy of this recipe"
                    Command="{Binding CopyRecipeCommand}" />
            <!-- Visible to admin OR the recipe owner -->
            <Button Content="Delete" Width="160" Height="30" Margin="4"
                    ToolTip="Delete this recipe"
                    Command="{Binding PerformDeleteCommand}" 
                    Visibility="{Binding IsOwnerOrAdmin, Converter={StaticResource BoolToVis}}"
                    Style="{StaticResource ButtonDangerStyle}"/>
            <Button Content="Close" Width="160" Height="30" Margin="4"
                    ToolTip="Close without saving changes"
                    Command="{Binding PerformCloseCommand}"
                    Style="{StaticResource ButtonLightGrayStyle}"/>
        </StackPanel>

        <!-- Left column: recipe details -->
        <ScrollViewer Grid.Row="2" Grid.Column="0"
              VerticalScrollBarVisibility="Auto"
              HorizontalScrollBarVisibility="Disabled"
              CanContentScroll="True">
            <StackPanel>
                <Grid Margin="4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Created" Margin="0,4,4,4" FontWeight="DemiBold"/>
                        <TextBlock Text="{Binding Created, StringFormat=\{0:yyyy-MM-dd HH:mm:ss\}}" Margin="0,4,4,4"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1">
                        <TextBlock Grid.Column="1" Text="Updated" Margin="0,4,4,4" FontWeight="DemiBold"/>
                        <TextBlock Grid.Column="1" Text="{Binding Updated, StringFormat=\{0:yyyy-MM-dd HH:mm:ss\}}" Margin="0,4,4,4"/>
                    </StackPanel>
                </Grid>

                <TextBlock Text="Title" Margin="4" FontWeight="DemiBold"/>
                <TextBox Margin="4"
                         IsEnabled="{Binding IsEditing}"
                         Text="{Binding Title, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <TextBlock Text="Ingredients" Margin="4" FontWeight="DemiBold"/>
                <ListBox ItemsSource="{Binding Ingredients}"
                         SelectedItem="{Binding SelectedIngredient}"
                         IsEnabled="{Binding IsEditing}"
                         Height="100" Margin="4"/>

                <!-- Add / Remove controls -->
                <StackPanel Orientation="Horizontal" Margin="4">
                    <TextBox Width="300" Margin="0,0,4,0"
                             IsEnabled="{Binding IsEditing}"
                             Text="{Binding NewIngredientText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Content="Add" Width="80"
                            IsEnabled="{Binding IsEditing}"
                            Command="{Binding AddIngredientCommand}"
                            Margin="0,0,4,0"/>
                    <Button Content="Remove" Width="80"
                            IsEnabled="{Binding IsEditing}"
                            Command="{Binding RemoveIngredientCommand}"/>
                </StackPanel>

                <TextBlock Text="Instructions" Margin="4" FontWeight="DemiBold"/>
                <TextBox Margin="4" Height="100"
                         IsEnabled="{Binding IsEditing}"
                         Text="{Binding Instructions, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto"/>

                <TextBlock Text="Category" Margin="4" FontWeight="DemiBold"/>
                <ComboBox Margin="4"
                          IsEnabled="{Binding IsEditing}"
                          ItemsSource="{Binding Categories}"
                          SelectedItem="{Binding Category, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <!-- Owner (visible only to admin) -->
                <TextBlock Text="Owner" Margin="4" FontWeight="DemiBold" Visibility="{Binding IsAdmin, Converter={StaticResource BoolToVis}}"/>
                <ComboBox Margin="4"
                          ItemsSource="{Binding Users}"
                          SelectedItem="{Binding Owner, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          DisplayMemberPath="Username"
                          Visibility="{Binding IsAdmin, Converter={StaticResource BoolToVis}}"
                          IsEnabled="{Binding IsEditing}"/>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
